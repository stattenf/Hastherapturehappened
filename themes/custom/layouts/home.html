{{ define "main" }}
<div class="hero-container">
  <!-- Background Image -->
  <div class="background-image" style="background-image: url('{{ .Site.Params.backgroundImage | default "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1920 1080'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1920' height='1080' fill='url(%23bg)'/%3E%3C/svg%3E" }}');"></div>
  
  <!-- Floating Title -->
  <div class="floating-title">
    <h1>{{ .Site.Title | default "Has The Rapture Happened?" }}</h1>
  </div>
  
  <!-- Recent Page (fades in after delay) -->
  <div class="recent-post" id="recent-post">
    {{ $recentPage := (where site.RegularPages "Section" "") | first 1 }}
    {{ range $recentPage }}
    <div class="post-content-title-style">
      <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
      <div class="post-excerpt-title-style">
        {{ .Summary | default (truncate 200 .Content) }}
      </div>
    </div>
    {{ end }}
  </div>
  
  <!-- Show Post Button -->
  <button id="show-post-btn" class="show-post-button">Prior Raptures</button>
  
  <!-- Floating Post Content (initially hidden) -->
  <div id="floating-post-content" class="floating-post-content" style="display: none;">
    <div class="floating-post-header">
      <div class="floating-post-title-section">
        <h3 id="floating-post-title">First Post</h3>
        <span id="floating-post-date" class="floating-post-date"></span>
      </div>
      <button id="close-post-btn" class="close-post-button">✕</button>
    </div>
    <div class="floating-post-body">
      <div class="floating-post-content-area">
        <div id="floating-post-full-content" class="floating-post-full-content">
          <!-- Full post content will be populated by JavaScript -->
        </div>
      </div>
      <div class="floating-post-navigation">
        <button id="prev-post-btn" class="nav-button prev-button">← Previous</button>
        <button id="next-post-btn" class="nav-button next-button">Next →</button>
      </div>
    </div>
  </div>
</div>

<script>
// Fade in recent post after 3 seconds
document.addEventListener('DOMContentLoaded', function() {
  const recentPost = document.getElementById('recent-post');
  if (recentPost) {
    recentPost.style.opacity = '0';
    recentPost.style.transform = 'translateY(30px)';
    
    setTimeout(function() {
      recentPost.style.transition = 'opacity 2s ease-in-out, transform 2s ease-in-out';
      recentPost.style.opacity = '1';
      recentPost.style.transform = 'translateY(0)';
    }, 3000);
  }
  
  // Post navigation data
  const posts = [
    {{ range (where site.RegularPages "Type" "posts") }}
    {
      title: {{ .Title | jsonify }},
      url: {{ .RelPermalink | jsonify }},
      excerpt: {{ (.Summary | default (truncate 300 .Content)) | jsonify }},
      content: {{ .Content | jsonify }},
      date: {{ .Date | jsonify }}
    },
    {{ end }}
  ];
  
  let currentPostIndex = 0;
  
  // Debug: Log posts data
  console.log('Posts data:', posts);
  console.log('Button element:', document.getElementById('show-post-btn'));
  
  // Test button click
  const testBtn = document.getElementById('show-post-btn');
  if (testBtn) {
    console.log('Button found, adding test listener');
    testBtn.addEventListener('click', function() {
      console.log('Button clicked!');
    });
  } else {
    console.log('Button not found!');
  }
  
  // Update floating post content
  function updateFloatingPost(index) {
    if (posts.length === 0) {
      console.log('No posts available');
      return;
    }
    
    console.log('Updating post at index:', index, 'Post data:', posts[index]);
    
    const post = posts[index];
    const titleElement = document.getElementById('floating-post-title');
    const dateElement = document.getElementById('floating-post-date');
    const fullContentElement = document.getElementById('floating-post-full-content');
    const prevBtn = document.getElementById('prev-post-btn');
    const nextBtn = document.getElementById('next-post-btn');
    
    // Remove extra quotes from title (define at top so it can be used throughout)
    let cleanTitle = post.title.replace(/^"|"$/g, '');
    
    if (titleElement) {
      titleElement.textContent = cleanTitle;
    }
    
    if (dateElement) {
      // Format the date nicely
      let postDate = post.date.replace(/^"|"$/g, ''); // Remove quotes
      let date = new Date(postDate);
      let formattedDate = date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
      dateElement.textContent = formattedDate;
    }
    
    if (fullContentElement) {
      // The content is already HTML from Hugo, just decode it and remove extra quotes
      let htmlContent = post.content;
      
      if (htmlContent && htmlContent.trim()) {
        // Remove leading and trailing quotes and decode Unicode escape sequences
        htmlContent = htmlContent
          .replace(/^"|"$/g, '') // Remove leading and trailing quotes
          .replace(/\\u003c/g, '<')
          .replace(/\\u003e/g, '>')
          .replace(/\\u0026/g, '&')
          .replace(/\\u0027/g, "'")
          .replace(/\\u0022/g, '"')
          .replace(/\\n/g, '\n');
        
        fullContentElement.innerHTML = htmlContent;
      } else {
        fullContentElement.innerHTML = '<p><em>No content available</em></p>';
      }
    }
    
    // Update navigation buttons
    if (prevBtn) {
      prevBtn.disabled = index === 0;
      prevBtn.style.opacity = index === 0 ? '0.5' : '1';
    }
    if (nextBtn) {
      nextBtn.disabled = index === posts.length - 1;
      nextBtn.style.opacity = index === posts.length - 1 ? '0.5' : '1';
    }
  }
  
  // Function to resize and center the floating post window
  function resizeFloatingWindow() {
    const floatingPostContent = document.getElementById('floating-post-content');
    if (!floatingPostContent) return;
    
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    
    // Calculate dimensions for 80% of screen height, centered horizontally
    const targetHeight = windowHeight * 0.8;
    const targetTop = windowHeight * 0.1; // 10% from top = 80% height
    
    // Set width based on screen size with some padding
    let targetWidth;
    if (windowWidth <= 480) {
      targetWidth = windowWidth * 0.95; // 95% on very small screens
    } else if (windowWidth <= 768) {
      targetWidth = windowWidth * 0.9; // 90% on tablets
    } else {
      targetWidth = Math.min(windowWidth * 0.8, 800); // 80% on desktop, max 800px
    }
    
    // Apply the new dimensions
    floatingPostContent.style.width = targetWidth + 'px';
    floatingPostContent.style.height = targetHeight + 'px';
    floatingPostContent.style.top = targetTop + 'px';
    floatingPostContent.style.left = '50%';
    floatingPostContent.style.transform = 'translateX(-50%)';
    floatingPostContent.style.maxWidth = 'none';
    floatingPostContent.style.maxHeight = 'none';
  }
  
  // Handle show post button
  const showPostBtn = document.getElementById('show-post-btn');
  const floatingPostContent = document.getElementById('floating-post-content');
  const closePostBtn = document.getElementById('close-post-btn');
  
  if (showPostBtn && floatingPostContent) {
    showPostBtn.addEventListener('click', function() {
      console.log('Prior Raptures button clicked');
      console.log('Posts available:', posts.length);
      
      if (posts.length === 0) {
        console.log('No posts available');
        alert('No posts available');
        return;
      }
      
      currentPostIndex = 0; // Start with first post
      updateFloatingPost(currentPostIndex);
      
      // Resize and center the window
      resizeFloatingWindow();
      
      floatingPostContent.style.display = 'block';
      floatingPostContent.style.opacity = '0';
      floatingPostContent.style.transform = 'translateX(-50%) translateY(20px)';
      
      setTimeout(function() {
        floatingPostContent.style.transition = 'opacity 0.3s ease-in-out, transform 0.3s ease-in-out';
        floatingPostContent.style.opacity = '1';
        floatingPostContent.style.transform = 'translateX(-50%) translateY(0)';
      }, 10);
    });
  } else {
    console.log('Button or floating content not found:', {
      showPostBtn: !!showPostBtn,
      floatingPostContent: !!floatingPostContent
    });
  }
  
  // Resize window on screen resize
  window.addEventListener('resize', function() {
    if (floatingPostContent && floatingPostContent.style.display === 'block') {
      resizeFloatingWindow();
    }
  });
  
  if (closePostBtn && floatingPostContent) {
    closePostBtn.addEventListener('click', function() {
      floatingPostContent.style.transition = 'opacity 0.3s ease-in-out, transform 0.3s ease-in-out';
      floatingPostContent.style.opacity = '0';
      floatingPostContent.style.transform = 'translateX(-50%) translateY(20px)';
      
      setTimeout(function() {
        floatingPostContent.style.display = 'none';
      }, 300);
    });
  }
  
  // Handle navigation buttons
  const prevPostBtn = document.getElementById('prev-post-btn');
  const nextPostBtn = document.getElementById('next-post-btn');
  
  if (prevPostBtn) {
    prevPostBtn.addEventListener('click', function() {
      if (currentPostIndex > 0) {
        currentPostIndex--;
        updateFloatingPost(currentPostIndex);
      }
    });
  }
  
  if (nextPostBtn) {
    nextPostBtn.addEventListener('click', function() {
      if (currentPostIndex < posts.length - 1) {
        currentPostIndex++;
        updateFloatingPost(currentPostIndex);
      }
    });
  }
});
</script>
{{ end }}


